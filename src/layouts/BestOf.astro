---
import Base from './Base.astro';
import TableOfContents from '../components/TableOfContents.astro';

export interface Props {
  title: string;
  description: string;
  h1: string;
  intro: string;
  lastUpdated: string;
  productsCount: number;
  tocItems: { id: string; label: string; rank?: number }[];
  schema?: object; // JSON-LD ItemList schema
  breadcrumb?: { label: string; href: string }[];
}

const {
  title,
  description,
  h1,
  intro,
  lastUpdated,
  productsCount,
  tocItems,
  schema,
  breadcrumb = [],
} = Astro.props;
---

<Base title={title} description={description}>
  <!-- JSON-LD Schema -->
  {schema && (
    <script type="application/ld+json" set:html={JSON.stringify(schema)} slot="head" />
  )}

  <!-- â”€â”€ Hero article â”€â”€ -->
  <section class="bg-cream-dark border-b border-oak-100">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-10">

      <!-- Breadcrumb -->
      {breadcrumb.length > 0 && (
        <nav class="flex items-center gap-2 text-xs text-ink-muted mb-6" aria-label="Breadcrumb">
          <a href="/" class="hover:text-ink transition-colors">Accueil</a>
          {breadcrumb.map(item => (
            <>
              <span class="opacity-40">/</span>
              <a href={item.href} class="hover:text-ink transition-colors">{item.label}</a>
            </>
          ))}
        </nav>
      )}

      <div class="max-w-3xl">
        <!-- Tag -->
        <span class="badge bg-electric/10 text-electric border border-electric/20 mb-4">
          Guide d'achat Â· {productsCount} produits testÃ©s
        </span>

        <!-- H1 -->
        <h1 class="font-display text-4xl sm:text-5xl font-bold text-ink leading-tight mb-4">
          {h1}
        </h1>

        <p class="text-lg text-ink-muted leading-relaxed mb-5">{intro}</p>

        <!-- Meta -->
        <div class="flex flex-wrap items-center gap-4 text-sm text-ink-muted">
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Mis Ã  jour le {lastUpdated}
          </div>
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            {productsCount} modÃ¨les comparÃ©s
          </div>
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
            Prix Amazon vÃ©rifiÃ©s
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- â”€â”€ Content avec sidebar â”€â”€ -->
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-12">
    <div class="grid lg:grid-cols-[1fr_280px] gap-10 items-start">

      <!-- Contenu principal -->
      <div class="min-w-0">
        <slot />
      </div>

      <!-- Sidebar sticky -->
      <aside class="hidden lg:block sticky top-24 space-y-6">
        <TableOfContents
          items={tocItems}
          lastUpdated={lastUpdated}
          productsCount={productsCount}
        />

        <!-- Widget Amazon disclosure -->
        <div class="rounded-2xl bg-amber-50 border border-amber-200 p-4">
          <p class="text-xs text-amber-800 leading-relaxed">
            <strong>ðŸ’¡ Info prix :</strong> Les prix affichÃ©s sont indicatifs et peuvent varier. Toujours vÃ©rifier le prix actuel sur Amazon.
          </p>
        </div>

        <!-- Pinterest CTA -->
        <div class="rounded-2xl bg-rose-50 border border-rose-200 p-4 text-center">
          <p class="text-2xl mb-2">ðŸ“Œ</p>
          <p class="font-display font-bold text-ink text-sm mb-1">Ã‰pingler ce guide</p>
          <p class="text-xs text-ink-muted mb-3">Retrouvez-le facilement sur Pinterest</p>
          <a
            href="https://fr.pinterest.com/zerozeroalcool/"
            target="_blank"
            rel="noopener"
            class="inline-flex items-center gap-1.5 text-xs font-semibold text-rose-700 hover:text-rose-800 transition-colors"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738a.36.36 0 01.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.632-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0z"/></svg>
            Suivre sur Pinterest
          </a>
        </div>
      </aside>
    </div>
  </div>
</Base>
